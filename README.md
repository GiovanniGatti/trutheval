# TruthEval

# Using the perturbation pipeline

# Using the cost-efficient Factual Correctness metric

# Datasets

We are also open-sourcing the [datasets](./datasets) we used to access the quality of our pipeline. In short, we asked
annotators to compare the perceived quality of answers between experts and pipeline generated. The annotators needed to
decide which option aligned best to a specific set of guidelines (which can be found at our paper; see Appendix C). The
annotators have the alternative of accepting both options (if they had perceived similar quality) or rejecting them
both (if they both didn't comply with guidelines).

```text
├── datasets
│   ├── evaluation                         # datasets used for evaluating LLMs and other techniques (Section 5) 
│   │   ├── dataset.json                   # the pipeline generated dataset (with A0 -> A4)
│   │   ├── factual_correctness_eval.jsonl # evaluation for fast-fc (our cost efficient implementation and ragas (default)
│   │   ├── gold-dataset.json              # set of Question and groundtruths sampled from Google's Natural Questions dataset
│   │   ├── llm_as_judge_eval.jsonl        # evaluation of several LLMs for factual correctness
│   │   ├── report.json                    # detailed report of the question transformations 
│   ├── human-assessment                   # datasets used for validating the quality of the pipeline (Section 4)
│   │   ├── assessment-dataset.json        # set of Q&As manually fabricated by experts (including A0 -> A4) with alternative versions produced by our pipeline
│   │   ├── report.json                    # the pipeline report with details about the incremental changes when producing the "ai" responses in assessment-dataset.json
│   │   ├── results-evaluator-1.json       # assessment from evaluator 1 (preferences)
│   │   ├── results-evaluator-2.json       # assessment from evaluator 2 (preferences) 
```

# UI

We provide a user-friendly webapp to facilitate comparing A0-A4 responses generated by different sources. The UI
provides a side-by-side visualization with diff capabilities. This tool was used by annotators to produce evaluate the
quality of our pipeline.

One must provide an input dataset with the following schema:

```json
{
  "questions": [
    {
      "id": 0,
      "question": "What are the main causes of climate change?",
      "ground_truth": "Climate change is primarily ...",
      "answers": {
        "A0": {
          "ai": "Human activities are the main drivers of climate change...",
          "human": "The primary driver of climate change is human activity..."
        },
        "A1": {
          "ai": "...",
          "human": "..."
        },
        "A2": {
          "ai": "...",
          "human": "..."
        },
        "A3": {
          "ai": "...",
          "human": "..."
        },
        "A4": {
          "ai": "...",
          "human": "..."
        }
      }
    },
    ...
  ]
}
```

After evaluation, the results are exported with the following format (dictionary keys are the ids from the previous
file).

```json
{
  "0": {
    "A0": "Both are bad",
    "A1": "AI",
    "A2": "Both are good",
    "A3": "AI",
    "A4": "Expert"
  },
  "1": {
    "A0": "...",
    "A1": "...",
    "A2": "...",
    "A3": "...",
    "A4": "..."
  },
  ...
}
```

To launch the tool, first install the dependencies with `pip install -r ui/requirements.txt`. Then, you can run

```bash
python ui/evaluation_interface.py ./datasets/human-assessment/assessment-dataset.json ./datasets/results-evaluator-x.json
```

The application will start at [http://127.0.0.1:7860](http://127.0.0.1:7860) which can be access with your browser.

# Prompts

# Cite this work
